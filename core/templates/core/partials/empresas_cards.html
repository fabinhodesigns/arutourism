{% load static %}

{% for empresa in page_obj %}
<div class="col">
  <div class="card h-100 shadow-sm empresa-card">
    <a href="{% url 'empresa_detalhe' empresa.slug %}" class="card-link-overlay"></a>

    {% if empresa.imagem_principal %}
      <img src="{{ empresa.imagem_principal.imagem.url }}" class="card-img-top" alt="{{ empresa.nome }}">
    {% else %}
      <div class="card-img-top-placeholder d-flex align-items-center justify-content-center">
        <i class="bi bi-image-alt"></i>
      </div>
    {% endif %}
    {# FIM DA CORREÇÃO #}

    <div class="card-body d-flex flex-column">
      {% if empresa.tags.all %}
        <div class="badge bg-primary bg-gradient rounded-pill mb-2">{{ empresa.tags.first.nome }}</div>
      {% else %}
        <div class="badge bg-secondary bg-gradient rounded-pill mb-2">Sem Categoria</div>
      {% endif %}
      
      <h5 class="card-title">{{ empresa.nome }}</h5>
      <p class="card-text mb-4">{{ empresa.descricao|truncatechars:100 }}</p>

      {% if empresa.total_avaliacoes > 0 %}
        <div class="card-rating mb-2">
            <i class="bi bi-star-fill"></i>
            <span class="fw-bold">{{ empresa.nota_media|floatformat:1 }}</span>
            <span class="text-muted small">({{ empresa.total_avaliacoes }} avaliaç{% if empresa.total_avaliacoes > 1 %}ões{% else %}ão{% endif %})</span>
        </div>
      {% endif %}
      <p class="card-text mb-4">{{ empresa.descricao|truncatechars:100 }}</p>

      <div class="mt-auto">
        <div class="d-flex align-items-center text-muted small">
          <i class="bi bi-person-circle me-2 fs-5"></i>
          <div>
            <div class="fw-bold">{{ empresa.user.username }}</div>
            <div>{{ empresa.data_cadastro|date:"d M, Y" }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endfor %}