{% extends 'core/base.html' %}
{% load static %}

{% block title %}{{ empresa.nome }} - Detalhes{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="card shadow-sm rounded-4 p-4 bg-white">
        {% if empresa.imagem %}
            <img src="{{ empresa.imagem.url }}" alt="{{ empresa.nome }}" class="img-fluid rounded mb-4" style="max-height: 400px; width: 100%; object-fit: cover;">
        {% endif %}

        <h2 class="fw-bold mb-3">{{ empresa.nome }}</h2>
        <div class="mb-2">
            <span class="badge bg-primary">{{ empresa.categoria.nome }}</span>
        </div>
        <p class="mb-3">{{ empresa.descricao }}</p>

        <ul class="list-group mb-4">
            <li class="list-group-item"><strong>Rua:</strong> {{ empresa.rua }}, <strong>Número:</strong> {{ empresa.numero }}</li>
            <li class="list-group-item"><strong>Bairro:</strong> {{ empresa.bairro }}</li>
            <li class="list-group-item"><strong>Cidade:</strong> {{ empresa.cidade }}</li>
            <li class="list-group-item"><strong>CEP:</strong> {{ empresa.cep }}</li>
            <li class="list-group-item"><strong>Telefone:</strong> {{ empresa.telefone }}</li>
            <li class="list-group-item"><strong>Email:</strong> {{ empresa.email }}</li>
            {% if empresa.site %}
            <li class="list-group-item"><strong>Site:</strong> <a href="{{ empresa.site }}" target="_blank">{{ empresa.site }}</a></li>
            {% endif %}
        </ul>

        <div id="map" style="height: 350px; border-radius: 8px;"></div>

        <a href="https://www.google.com/maps/search/?api=1&query={{ empresa.latitude }},{{ empresa.longitude }}" 
           target="_blank" 
           class="btn btn-primary mt-3">
           Localizar no Google Maps
        </a>
    </div>
</div>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        crossorigin=""></script>

<script>
document.addEventListener('DOMContentLoaded', function () {
    var lat = parseFloat('{{ empresa.latitude }}');
    var lon = parseFloat('{{ empresa.longitude }}');
    var map = L.map('map').setView([lat, lon], 15);

    // Camada satélite ESRI World Imagery
    L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles &copy; Esri &mdash; Source: Esri, NASA, NOAA',
        maxZoom: 19
    }).addTo(map);

    L.marker([lat, lon]).addTo(map);
});
</script>
{% endblock %}